(()=>{"use strict";var e=[[[1,0,0],[1,0,0],[1,1,1]],[[0,1,1],[1,1,0]],[[1],[1],[1],[1]],[[1,1,1],[0,1,0],[0,1,0]],[[0,1],[0,1],[1,1]],[[1,0],[1,0],[1,1]],[[1,1],[1,1]]],r=document.querySelector("#scores"),t=document.querySelector("#level"),n=document.querySelector("#gameOver"),o=n.querySelector("#gameOverMessage"),i=document.querySelector("#canvas");i.width=300,i.height=600;var a,f=canvas.getContext("2d"),u=30,l=20,v=10,c=Array.from({length:l},(function(){return Array(v).fill(0)})),s=-2,h=3,d=0,g=1,y=1e3;function w(){if(c[0].includes(1))return window.removeEventListener("keydown",m),n.style.visibility="visible",o.textContent="GAME OVER",i.style.filter="blur(2px)",void(f.globalAlpha=.6);var u,w=function(){for(var e=!1,r=[],t=0;t<l;t++)c[t].every((function(e){return 1===e}))&&(r.push(t),e=!0);return{res:e,rowsForDeletion:r}}(),A=w.res,p=w.rowsForDeletion;A&&(p.forEach((function(e){c.splice(e,1),c.unshift(Array(v).fill(0))})),d+=v,r.textContent=d,d%80==0&&(g+=1,t.textContent=g,y-=100,clearInterval(E),E=setInterval(q,y))),u=Math.floor(Math.random()*e.length),a=e[u],s=-a.length,h=3,C(),window.addEventListener("keydown",m)}function m(e){switch(e.key){case"ArrowDown":q();break;case"ArrowRight":S(r=h+1,t=s)&&k(r,t)&&(A(),h+=1,p());break;case"ArrowLeft":!function(){var e=h-1,r=s;S(e)&&x(e,r)&&(A(),h-=1,p())}();break;case"ArrowUp":!function(){var e=JSON.parse(JSON.stringify(c));A();var r=a[0].map((function(e,r){return a.map((function(e){return e[r]})).reverse()})),t=a;a=r,b(h,s)&&S(h)&&x(h,s)&&k(h,s)?(A(),p()):(a=t,c=e)}()}var r,t}function A(){for(var e=0;e<a.length;e++)for(var r=0;r<a[e].length;r++)void 0!==c[s+e]&&1===a[e][r]&&(c[s+e][h+r]=0)}function p(){for(var e=0;e<a.length;e++)for(var r=0;r<a[e].length;r++)void 0!==c[s+e]&&1===a[e][r]&&(c[s+e][h+r]=1)}function S(e,r){var t;return a.forEach((function(e){return t=e.length})),!(e<0||e+t>v)}function b(e,r){if(r+a.length>l)return!1;for(var t=0;t<a.length;t++)for(var n=0;n<a[t].length;n++)if(0!==a[t][n]&&void 0!==c[r+t]&&(void 0===a[t+1]||void 0===a[t+1][n]||0===a[t+1][n])&&c[r+t][n+e])return!1;return!0}function x(e,r){for(var t=0;t<a.length;t++)for(var n=0;n<a[t].length;n++)if(0!==a[t][n]&&(void 0===a[t]||0===a[t][n-1]||void 0===a[t][n-1])){if(void 0===c[r+t])continue;if(c[r+t][n+e])return!1}return!0}function k(e,r){for(var t=0;t<a.length;t++)for(var n=0;n<a[t].length;n++)if(0!==a[t][n]&&(void 0===a[t]||0===a[t][n+1]||void 0===a[t][n+1])){if(void 0===c[r+t])continue;if(c[r+t][n+e])return!1}return!0}function q(){b(h,s+1)?(A(),s+=1,p()):w()}function C(){f.clearRect(0,0,i.width,i.height);for(var e=0;e<l;e++)for(var r=0;r<v;r++)1===c[e][r]&&(f.fillStyle="#000001",f.fillRect(r*u,e*u,u-1,u-1));requestAnimationFrame(C)}r.textContent=d,t.textContent=g,w();var E=setInterval(q,y)})();